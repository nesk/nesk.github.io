<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.dc22e8c7045ddbe5e3b1.css" data-identity="gatsby-global-css">/*!
 * Bootstrap Reboot v4.6.1 (https://getbootstrap.com/)
 * Copyright 2011-2021 The Bootstrap Authors
 * Copyright 2011-2021 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
 * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md)
 */*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:sans-serif;line-height:1.15}article,aside,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}body{background-color:#fff;color:#212529;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1rem;font-weight:400;line-height:1.5;margin:0;text-align:left}[tabindex="-1"]:focus:not(:focus-visible){outline:0!important}hr{box-sizing:content-box;height:0;overflow:visible}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;margin-top:0}p{margin-bottom:1rem;margin-top:0}abbr[data-original-title],abbr[title]{border-bottom:0;cursor:help;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{font-style:normal;line-height:inherit}address,dl,ol,ul{margin-bottom:1rem}dl,ol,ul{margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{background-color:transparent;color:#007bff;text-decoration:none}a:hover{color:#0056b3;text-decoration:underline}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{-ms-overflow-style:scrollbar;margin-bottom:1rem;margin-top:0;overflow:auto}figure{margin:0 0 1rem}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}caption{caption-side:bottom;color:#6c757d;padding-bottom:.75rem;padding-top:.75rem;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}label{display:inline-block;margin-bottom:.5rem}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit;margin:0}button,input{overflow:visible}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}textarea{overflow:auto;resize:vertical}fieldset{border:0;margin:0;min-width:0;padding:0}legend{color:inherit;display:block;font-size:1.5rem;line-height:inherit;margin-bottom:.5rem;max-width:100%;padding:0;white-space:normal;width:100%}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:none;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}output{display:inline-block}summary{cursor:pointer;display:list-item}template{display:none}[hidden]{display:none!important}.grvsc-container{-webkit-overflow-scrolling:touch;-webkit-font-feature-settings:normal;font-feature-settings:normal;border-radius:8px;border-radius:var(--grvsc-border-radius,8px);line-height:1.4;overflow:auto;padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));position:relative}.grvsc-code{display:table}.grvsc-line{box-sizing:border-box;display:table-row;width:100%}.grvsc-line,.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter:before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty:after{content:" ";-webkit-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line:before{content:" ";position:absolute;width:100%}.grvsc-line-diff-add:before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del:before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{opacity:.7;padding:0 2px;text-align:right}:root{--content-spacing:1rem;--shadow:rgba(67,75,81,.25);--grey-100-light:#f1f2f4;--grey-200-light:#e6e8ea;--grey-250-light:#c7cdd1;--grey-300-light:#7e8b95;--grey-400-light:#636f79;--grey-600-light:#49535a;--grey-700-light:#353b41;--grey-800-light:#22272a;--grey-100-dark:#212529;--grey-200-dark:#2d3237;--grey-250-dark:#373e43;--grey-300-dark:#65727b;--grey-400-dark:#86939c;--grey-600-dark:#c7cdd1;--grey-700-dark:#d5d9dd;--grey-800-dark:#e3e6e8;--primary-500-light:#0a71c0;--primary-600-light:#0967ae;--primary-400-dark:#52b4ff;--primary-500-dark:#1f9eff;--note-100-light:#e8ddfd;--note-700-light:#590df2;--note-100-dark:#422e6b;--note-700-dark:#b48fff;--warning-100-light:#fde2e2;--warning-700-light:#d00b0b;--warning-100-dark:#6b2e2e;--warning-700-dark:#ff8f8f;--color-bg-code-light:var(--grey-800-light);--color-bg-code-inline-light:#fff;--color-border-code-inline-light:var(--grey-200-light);--color-bg-code-fold-light:var(--grey-100-light);--color-aside-link-light:var(--primary-600-light);--color-bg-code-dark:var(--grey-200-dark);--color-bg-code-inline-dark:var(--grey-200-dark);--color-border-code-inline-dark:var(--grey-250-dark);--color-bg-code-fold-dark:var(--grey-600-dark);--color-aside-link-dark:var(--primary-400-dark);--grvsc-border-radius:0.32rem;--grvsc-padding-v:1rem;--grvsc-padding-h:1.3rem;--grvsc-line-highlighted-border-width:0.28rem;--grvsc-line-highlighted-border-color:var(--primary-500-dark)}.light-theme:root,:root{--grey-100:var(--grey-100-light);--grey-200:var(--grey-200-light);--grey-250:var(--grey-250-light);--grey-300:var(--grey-300-light);--grey-400:var(--grey-400-light);--grey-600:var(--grey-600-light);--grey-700:var(--grey-700-light);--grey-800:var(--grey-800-light);--primary-500:var(--primary-500-light);--note-100:var(--note-100-light);--note-700:var(--note-700-light);--warning-100:var(--warning-100-light);--warning-700:var(--warning-700-light);--color-bg-code:var(--color-bg-code-light);--color-bg-code-inline:var(--color-bg-code-inline-light);--color-border-code-inline:var(--color-border-code-inline-light);--color-bg-code-fold:var(--color-bg-code-fold-light);--color-aside-link:var(--color-aside-link-light);--grvsc-line-highlighted-background-color:var(--grey-700-light)}@media (prefers-color-scheme:dark){:root{--grey-100:var(--grey-100-dark);--grey-200:var(--grey-200-dark);--grey-250:var(--grey-250-dark);--grey-300:var(--grey-300-dark);--grey-400:var(--grey-400-dark);--grey-600:var(--grey-600-dark);--grey-700:var(--grey-700-dark);--grey-800:var(--grey-800-dark);--primary-500:var(--primary-500-dark);--note-100:var(--note-100-dark);--note-700:var(--note-700-dark);--warning-100:var(--warning-100-dark);--warning-700:var(--warning-700-dark);--color-bg-code:var(--color-bg-code-dark);--color-bg-code-inline:var(--color-bg-code-inline-dark);--color-border-code-inline:var(--color-border-code-inline-dark);--color-bg-code-fold:var(--color-bg-code-fold-dark);--color-aside-link:var(--color-aside-link-dark);--grvsc-line-highlighted-background-color:var(--grey-250-dark)}}.dark-theme:root{--grey-100:var(--grey-100-dark);--grey-200:var(--grey-200-dark);--grey-250:var(--grey-250-dark);--grey-300:var(--grey-300-dark);--grey-400:var(--grey-400-dark);--grey-600:var(--grey-600-dark);--grey-700:var(--grey-700-dark);--grey-800:var(--grey-800-dark);--primary-500:var(--primary-500-dark);--note-100:var(--note-100-dark);--note-700:var(--note-700-dark);--warning-100:var(--warning-100-dark);--warning-700:var(--warning-700-dark);--color-bg-code:var(--color-bg-code-dark);--color-bg-code-inline:var(--color-bg-code-inline-dark);--color-border-code-inline:var(--color-border-code-inline-dark);--color-bg-code-fold:var(--color-bg-code-fold-dark);--color-aside-link:var(--color-aside-link-dark);--grvsc-line-highlighted-background-color:var(--grey-250-dark)}body{background:var(--grey-100);color:var(--grey-600)}p:last-child,ul:last-child{margin-bottom:0}a,a .sublink,a:hover,a:hover .sublink{color:var(--primary-500);text-decoration:underline}.focusable:focus,.focusable:focus-within,a:focus,a:focus .sublink{-moz-outline-radius:3px;outline:2px solid var(--primary-500);outline-offset:.2rem}.link-invisible,.link-invisible:focus,.link-invisible:hover{color:inherit;outline:none;text-decoration:none}.link-no-color-when-inactive:not(:hover):not(:focus):not(:active){color:inherit}code,pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:.9rem}pre,pre.grvsc-container{background:var(--color-bg-code);line-height:1.38rem;margin:0}pre>code{min-width:100%}:not(pre)>code{background:var(--color-bg-code-inline);border:1px solid var(--color-border-code-inline);border-radius:.3em;color:var(--grey-600);overflow-wrap:break-word;padding:.1em .25em;word-break:break-all}a>code{color:var(--primary-500);text-decoration:none}.grvsc-line.grvsc-line-highlighted{background-color:var(--grvsc-line-highlighted-background-color);box-shadow:inset var(--grvsc-line-highlighted-border-width) 0 0 0 var(--grvsc-line-highlighted-border-color)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line:before{content:none}.sr-only{clip:rect(0,0,0,0)!important;border:0!important;height:1px!important;margin:-1px!important;overflow:hidden!important;padding:0!important;position:absolute!important;white-space:nowrap!important;width:1px!important}.svg-inline--fa{display:var(--fa-display,inline-block);height:1em;overflow:visible;vertical-align:-.125em}</style><meta name="generator" content="Gatsby 3.14.6"/><title data-react-helmet="true">Mocking an exception in PHP — Blog — Johann Pardanaud</title><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png"/><meta data-react-helmet="true" name="description" content="Developer working @batch — Passionate climber"/><meta data-react-helmet="true" property="og:title" content="Mocking an exception in PHP — Blog"/><meta data-react-helmet="true" property="og:description" content="Developer working @batch — Passionate climber"/><meta data-react-helmet="true" property="og:image" content="https://johann.pardanaud.com/static/c248490ecdbd2b74bffdd079e09d65f2/fecc3/featured.jpg"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@undefined"/><meta data-react-helmet="true" name="twitter:title" content="Mocking an exception in PHP — Blog"/><meta data-react-helmet="true" name="twitter:description" content="Developer working @batch — Passionate climber"/><script data-react-helmet="true">
                    const darkMode = localStorage.getItem('dark-mode-preference')
                    if (darkMode === 'true' || darkMode === 'false') {
                        document.querySelector('html').classList.add(darkMode === 'true' ? 'dark-theme' : 'light-theme')
                    }
                </script><style data-styled="" data-styled-version="5.3.3">.bMsSPo{margin:0 auto;padding:0 var(--content-spacing);}/*!sc*/
@media (min-width:768px){.bMsSPo{width:42rem;}}/*!sc*/
@media (min-width:992px){.bMsSPo{width:53rem;}}/*!sc*/
data-styled.g1[id="content__Content-sc-t48hnk-0"]{content:"bMsSPo,"}/*!sc*/
.dzdWzc{position:relative;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;padding:0;background:transparent;border:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:1.5625rem;color:inherit;}/*!sc*/
.dzdWzc::after{position:absolute;top:-0.5rem;right:-0.5rem;bottom:-0.5rem;left:-0.5rem;content:"";}/*!sc*/
.dnHkDR{position:relative;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;padding:0;background:transparent;border:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:1.5625rem;}/*!sc*/
.dnHkDR::after{position:absolute;top:-0.5rem;right:-0.5rem;bottom:-0.5rem;left:-0.5rem;content:"";}/*!sc*/
data-styled.g2[id="button__IconButton-sc-ja09rx-0"]{content:"dzdWzc,dnHkDR,"}/*!sc*/
.kzLOCp{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;padding:var(--content-spacing) 0;background:var(--grey-200);font-size:1.125rem;font-weight:500;}/*!sc*/
.kzLOCp .content__Content-sc-t48hnk-0{display:grid;grid-template-rows:auto;grid-template-columns:1fr auto;grid-row-gap:1rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (min-width:768px){.kzLOCp .content__Content-sc-t48hnk-0{grid-template-columns:1fr auto auto;}}/*!sc*/
data-styled.g3[id="header__Container-sc-1fxfhwr-0"]{content:"kzLOCp,"}/*!sc*/
.kftGSv{position:fixed;top:0;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);}/*!sc*/
.kftGSv:not(:focus){opacity:0;pointer-events:none;}/*!sc*/
data-styled.g4[id="header__SkipLink-sc-1fxfhwr-1"]{content:"kftGSv,"}/*!sc*/
.kVWvDI{margin:0;font-size:inherit;font-weight:inherit;text-transform:uppercase;}/*!sc*/
data-styled.g5[id="header__TitleStrong-sc-1fxfhwr-2"]{content:"kVWvDI,"}/*!sc*/
@media (min-width:768px){.dmhOll{display:none;}}/*!sc*/
data-styled.g7[id="header__MenuButton-sc-1fxfhwr-4"]{content:"dmhOll,"}/*!sc*/
.edNlKR{grid-column:span 2;display:none;justify-items:end;grid-row-gap:calc(var(--content-spacing) * 2);grid-column-gap:calc(var(--content-spacing) * 3.5);}/*!sc*/
.edNlKR nav{display:grid;justify-items:end;}/*!sc*/
@media (min-width:768px){.edNlKR{display:grid;grid-auto-flow:column;}.edNlKR nav{grid-auto-flow:column;grid-gap:calc(var(--content-spacing) * 1.5);}}/*!sc*/
data-styled.g8[id="header__Menu-sc-1fxfhwr-5"]{content:"edNlKR,"}/*!sc*/
.eMRrAM:not(:hover):not(:focus):not(:active):not(.active){-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g9[id="header__NavLink-sc-1fxfhwr-6"]{content:"eMRrAM,"}/*!sc*/
.ccpENp{opacity:1;color:inherit;font-size:1.125rem;}/*!sc*/
.cbmlNR{opacity:0.3;color:inherit;font-size:1.125rem;}/*!sc*/
data-styled.g10[id="dark-mode__DarkModeIcon-sc-1kkowl3-0"]{content:"ccpENp,cbmlNR,"}/*!sc*/
.bOEjwE{display:grid;grid-template:"icon";margin:0 calc(var(--content-spacing) / 2);font-size:0.3125rem;}/*!sc*/
.bOEjwE svg{grid-area:icon;}/*!sc*/
.bOEjwE svg:nth-child(1){opacity:0;}/*!sc*/
.bOEjwE svg:nth-child(2){z-index:1;color:var(--primary-500);opacity:1;}/*!sc*/
data-styled.g11[id="dark-mode__DarkModeState-sc-1kkowl3-1"]{content:"bOEjwE,"}/*!sc*/
.cRwCOK{position:absolute;top:calc(100% + calc(var(--content-spacing) / 2));left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);border-radius:3px;padding:0.1em 0.4em;background:var(--grey-400);font-size:0.75rem;color:var(--grey-100);pointer-events:none;opacity:0;}/*!sc*/
data-styled.g12[id="dark-mode__DarkModeTooltip-sc-1kkowl3-2"]{content:"cRwCOK,"}/*!sc*/
.bHoUps{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;cursor:pointer;}/*!sc*/
.bHoUps .dark-mode__DarkModeTooltip-sc-1kkowl3-2,.bHoUps .dark-mode__DarkModeIcon-sc-1kkowl3-0,.bHoUps .dark-mode__DarkModeState-sc-1kkowl3-1 svg{-webkit-transition:all ease 250ms;transition:all ease 250ms;}/*!sc*/
.bHoUps:hover .dark-mode__DarkModeTooltip-sc-1kkowl3-2,.bHoUps:focus .dark-mode__DarkModeTooltip-sc-1kkowl3-2{opacity:1;}/*!sc*/
data-styled.g13[id="dark-mode__DarkModeContainer-sc-1kkowl3-3"]{content:"bHoUps,"}/*!sc*/
.iXgTak{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100vw;min-height:100vh;}/*!sc*/
data-styled.g14[id="layout__Container-sc-z8c7q8-0"]{content:"iXgTak,"}/*!sc*/
.hTFlju{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;padding:calc(var(--content-spacing) * 3) 0;}/*!sc*/
data-styled.g15[id="layout__Body-sc-z8c7q8-1"]{content:"hTFlju,"}/*!sc*/
.kVtDtt .content__Content-sc-t48hnk-0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;}/*!sc*/
.kVtDtt h1{font-size:2.5rem;-webkit-letter-spacing:0.015rem;-moz-letter-spacing:0.015rem;-ms-letter-spacing:0.015rem;letter-spacing:0.015rem;line-height:3.5rem;margin:0.5rem 0 2.5rem;}/*!sc*/
data-styled.g42[id="post__Header-sc-l8w1nw-0"]{content:"kVtDtt,"}/*!sc*/
.bRrpOE{font-size:0.8rem;color:var(--grey-400);}/*!sc*/
.bRrpOE address{display:inline;}/*!sc*/
data-styled.g43[id="post__Metadata-sc-l8w1nw-1"]{content:"bRrpOE,"}/*!sc*/
.kzuCuO{position:-webkit-sticky;position:sticky;top:25vh;}/*!sc*/
.kzuCuO >:first-child{position:absolute;left:100%;}/*!sc*/
@media (max-width:767.98px){.kzuCuO{display:none;}}/*!sc*/
@media (min-width:992px){.kzuCuO >:first-child{left:calc(100% + var(--content-spacing) * 1.5);}}/*!sc*/
data-styled.g44[id="post__Share-sc-l8w1nw-2"]{content:"kzuCuO,"}/*!sc*/
.iHUsPX{display:inline-block;margin-bottom:0.5rem;}/*!sc*/
data-styled.g45[id="post__StyledShareButton-sc-l8w1nw-3"]{content:"iHUsPX,"}/*!sc*/
.iwZWCm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-size:1.1rem;}/*!sc*/
.iwZWCm > *{max-width:100%;}/*!sc*/
.iwZWCm .post__Header-sc-l8w1nw-0{-webkit-order:-2;-ms-flex-order:-2;order:-2;}/*!sc*/
.iwZWCm .post__Share-sc-l8w1nw-2{-webkit-order:-1;-ms-flex-order:-1;order:-1;}/*!sc*/
.iwZWCm h2{margin-top:2.1rem;font-size:1.6rem;}/*!sc*/
.iwZWCm h3{margin-top:1.8rem;font-size:1.3rem;}/*!sc*/
.iwZWCm h4{margin-top:1.6rem;font-size:1.1rem;}/*!sc*/
.iwZWCm h5{margin-top:1.4rem;font-size:0.9rem;}/*!sc*/
.iwZWCm h6{margin-top:1.25rem;font-size:0.75rem;}/*!sc*/
.iwZWCm blockquote{border-left:4px solid;padding:0.3rem 1rem;line-height:1.6;font-style:italic;}/*!sc*/
.iwZWCm pre{margin-bottom:1rem;}/*!sc*/
data-styled.g46[id="post__Post-sc-l8w1nw-4"]{content:"iwZWCm,"}/*!sc*/
.fVFuJw{margin-bottom:2.5rem;}/*!sc*/
data-styled.g47[id="post__FeaturedImage-sc-l8w1nw-5"]{content:"fVFuJw,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="alternate" type="application/rss+xml" title="Johann Pardanaud&#x27;s RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-8b19332fe2a1c88eb1a0.js"/><link as="script" rel="preload" href="/framework-48c52bd1e5a78d41fccc.js"/><link as="script" rel="preload" href="/app-b8f044a4d43bf259ef7a.js"/><link as="script" rel="preload" href="/cb1608f2-204ee177e0779f974097.js"/><link as="script" rel="preload" href="/a9a7754c-af050843e75a27779682.js"/><link as="script" rel="preload" href="/commons-5b2d0278f9ad19a149ab.js"/><link as="script" rel="preload" href="/291a736a4998dc6bb1e7dae6dfd245355445eafd-6ac33ee7d44586680e94.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-dcb8e9e5dfbdb1e3ac22.js"/><link as="fetch" rel="preload" href="/page-data/blog/mocking-an-exception-in-php/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1092343521.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Container-sc-z8c7q8-0 iXgTak"><header class="header__Container-sc-1fxfhwr-0 kzLOCp"><a href="#main" class="header__SkipLink-sc-1fxfhwr-1 kftGSv">Skip to content</a><div class="content__Content-sc-t48hnk-0 bMsSPo"><strong class="header__TitleStrong-sc-1fxfhwr-2 kVWvDI">Johann Pardanaud</strong><button aria-label="Open menu" class="button__IconButton-sc-ja09rx-0 header__MenuButton-sc-1fxfhwr-4 dzdWzc dmhOll focusable"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button><div class="header__Menu-sc-1fxfhwr-5 edNlKR"><nav><a class="header__NavLink-sc-1fxfhwr-6 eMRrAM link-no-color-when-inactive" href="/">About</a><a class="header__NavLink-sc-1fxfhwr-6 eMRrAM link-no-color-when-inactive active" href="/blog/">Blog</a></nav><div class="dark-mode__DarkModeContainer-sc-1kkowl3-3 bHoUps focusable" tabindex="0" role="checkbox" aria-checked="mixed" aria-label="Dark mode: auto"><span class="dark-mode__DarkModeTooltip-sc-1kkowl3-2 cRwCOK">Auto</span><span class="dark-mode__DarkModeIcon-sc-1kkowl3-0 ccpENp"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"></path></svg></span><span class="dark-mode__DarkModeState-sc-1kkowl3-1 bOEjwE"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg></span><span class="dark-mode__DarkModeIcon-sc-1kkowl3-0 cbmlNR"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></span></div></div></div></header><main id="main" class="layout__Body-sc-z8c7q8-1 hTFlju"><article class="post__Post-sc-l8w1nw-4 iwZWCm"><header class="post__Header-sc-l8w1nw-0 kVtDtt"><div class="content__Content-sc-t48hnk-0 bMsSPo"><h1>Mocking an exception in PHP</h1><p class="post__Metadata-sc-l8w1nw-1 bRrpOE">Published<!-- --> <time dateTime="2020-08-06">6th August 2020</time>, by Johann Pardanaud</p></div><div class="post__FeaturedImage-sc-l8w1nw-5 fVFuJw gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:37.34375%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAMEBv/EABcBAAMBAAAAAAAAAAAAAAAAAAACBAX/2gAMAwEAAhADEAAAAc/bMwjFLf/EABkQAAMAAwAAAAAAAAAAAAAAAAACAxESE//aAAgBAQABBQJMuSjs3SSn/8QAFhEAAwAAAAAAAAAAAAAAAAAAAQIQ/9oACAEDAQE/AVE//8QAGBEBAQADAAAAAAAAAAAAAAAAAQADESH/2gAIAQIBAT8B12MQl//EABwQAAICAgMAAAAAAAAAAAAAAAIRAAEDEiFBsf/aAAgBAQAGPwLgpqmXkVVkNd0Ws//EABoQAAIDAQEAAAAAAAAAAAAAAAERACExQWH/2gAIAQEAAT8hJdlochDCKO5LRzIoH4J//9oADAMBAAIAAwAAABD0P//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQMBAT8QDBjpt//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEVH/2gAIAQIBAT8QwI5scVb/xAAbEAEAAwEAAwAAAAAAAAAAAAABESExAFFxof/aAAgBAQABPxAmdMEmlg+8ZjoZxfCqWu5PvmaSNOzYJh5be//Z" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/c248490ecdbd2b74bffdd079e09d65f2/2420f/featured.webp 640w,
/static/c248490ecdbd2b74bffdd079e09d65f2/99b9e/featured.webp 1280w,
/static/c248490ecdbd2b74bffdd079e09d65f2/cf520/featured.webp 2560w" sizes="(max-width: 2560px) 100vw, 2560px" /><source srcset="/static/c248490ecdbd2b74bffdd079e09d65f2/883ec/featured.jpg 640w,
/static/c248490ecdbd2b74bffdd079e09d65f2/eac4d/featured.jpg 1280w,
/static/c248490ecdbd2b74bffdd079e09d65f2/3ab09/featured.jpg 2560w" sizes="(max-width: 2560px) 100vw, 2560px" /><img loading="lazy" sizes="(max-width: 2560px) 100vw, 2560px" srcset="/static/c248490ecdbd2b74bffdd079e09d65f2/883ec/featured.jpg 640w,
/static/c248490ecdbd2b74bffdd079e09d65f2/eac4d/featured.jpg 1280w,
/static/c248490ecdbd2b74bffdd079e09d65f2/3ab09/featured.jpg 2560w" src="/static/c248490ecdbd2b74bffdd079e09d65f2/3ab09/featured.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></header><div class="content__Content-sc-t48hnk-0 bMsSPo"><p>When writing tests, you might sometimes need to mock an exception, this is an unusual case but it happened to me one year ago <a href="https://github.com/symfony/symfony/issues/28229#issuecomment-507273572">while overcoming a bug in Symfony&#x27;s Security component</a>. I needed to know if an exception was thrown by the <code>Symfony\Component\Security\Http\Firewall\AccessListener</code> class or not, I did it by writing a code similar to this:</p><pre class="grvsc-container one-dark-pro" data-language="php" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">use</span><span class="mtk1"> Symfony\Component\Security\Core\Exception\</span><span class="mtk11">AccessDeniedException</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">use</span><span class="mtk1"> Symfony\Component\Security\Http\Firewall\</span><span class="mtk11">AccessListener</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">class</span><span class="mtk1"> </span><span class="mtk11">ThrowerChecker</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">public</span><span class="mtk1"> </span><span class="mtk9">function</span><span class="mtk1"> </span><span class="mtk3">isThrownByFirewall</span><span class="mtk1">(</span><span class="mtk11">AccessDeniedException</span><span class="mtk1"> </span><span class="mtk4">$exception</span><span class="mtk1">): </span><span class="mtk11">bool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki">// Walking through the stack frames and returning true if one of them is triggered</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki">// by the firewall (Symfony\Component\Security\Http\Firewall\AccessListener)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">foreach</span><span class="mtk1"> (</span><span class="mtk4">$exception</span><span class="mtk1">-&gt;</span><span class="mtk3">getTrace</span><span class="mtk1">() </span><span class="mtk8">as</span><span class="mtk1"> </span><span class="mtk4">$stackItem</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">$class</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">$stackItem</span><span class="mtk1">[</span><span class="mtk6">&#x27;class&#x27;</span><span class="mtk1">] ?? </span><span class="mtk7">null</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk9">if</span><span class="mtk1"> (</span><span class="mtk4">$class</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk11">AccessListener</span><span class="mtk1">::</span><span class="mtk9">class</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk7">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk7">false</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre><p>However, testing this short piece of code can be quiet tricky. You can&#x27;t mock an exception and override the <code>getTrace()</code> method because it is marked as <strong>final</strong>—<a href="https://www.php.net/manual/en/class.exception.php#exception.synopsis">like many other ones</a>.</p><p>Since PHP 7, you can use the <a href="https://www.php.net/manual/en/class.throwable.php"><em>Throwable</em></a> interface, which can be easily mocked because interfaces can&#x27;t declare final methods. However, sometimes you might need to mock a specific implementation, like for the <code>isThrownByFirewall(AccessDeniedException $exception): bool</code> method declared in the previous code.</p><p>The only solution left is to use the <a href="https://www.php.net/manual/en/book.reflection.php"><em>Reflection API</em></a> to override the internal properties of the exception. You can easily know what are the internal properties of the class by dumping an instance of the <code>Exception</code> class:</p><pre class="grvsc-container one-dark-pro" data-language="php" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// I&#x27;m using a function here to generate the exception</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// because I want to show you a proper trace.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">function</span><span class="mtk1"> </span><span class="mtk3">generateException</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">Exception</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">var_dump</span><span class="mtk1">(</span><span class="mtk3">generateException</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">/*</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">  Outputs:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">  object(Exception)#1 (7) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;message&quot;:protected]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    string(0) &quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;string&quot;:&quot;Exception&quot;:private]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    string(0) &quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;code&quot;:protected]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    int(0)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;file&quot;:protected]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    string(35) &quot;/Users/johann/Desktop/exception.php&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;line&quot;:protected]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    int(5)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;trace&quot;:&quot;Exception&quot;:private]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    array(1) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">      [0]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">      array(4) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        [&quot;file&quot;]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        string(35) &quot;/Users/johann/Desktop/exception.php&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        [&quot;line&quot;]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        int(8)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        [&quot;function&quot;]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        string(17) &quot;generateException&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        [&quot;args&quot;]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        array(0) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    [&quot;previous&quot;:&quot;Exception&quot;:private]=&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    NULL</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">*/</span></span></span></code></pre><p>Here you can see the <code>trace</code> property contains what would have been returned by the <code>getTrace()</code> method if we called it, this is what needs to changed to properly mock the exception trace. Let&#x27;s write a simple test with a method handling the modification for us:</p><pre class="grvsc-container grvsc-has-line-highlighting one-dark-pro" data-language="php" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">use</span><span class="mtk1"> PHPUnit\Framework\</span><span class="mtk11">TestCase</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">use</span><span class="mtk1"> Symfony\Component\Security\Core\Exception\</span><span class="mtk11">AccessDeniedException</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">use</span><span class="mtk1"> Symfony\Component\Security\Http\Firewall\</span><span class="mtk11">AccessListener</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">class</span><span class="mtk1"> </span><span class="mtk11">ThrowerCheckerTest</span><span class="mtk1"> </span><span class="mtk9">extends</span><span class="mtk1"> </span><span class="mtk11">TestCase</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">public</span><span class="mtk1"> </span><span class="mtk9">function</span><span class="mtk1"> </span><span class="mtk3">testIfExceptionsThrownByFirewallAreDetected</span><span class="mtk1">(): </span><span class="mtk11">void</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$exception</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">AccessDeniedException</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">self</span><span class="mtk1">::</span><span class="mtk3">overrideExceptionTrace</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">$exception</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">            [[</span><span class="mtk6">&#x27;class&#x27;</span><span class="mtk1"> =&gt; </span><span class="mtk6">&#x27;foo&#x27;</span><span class="mtk1">],</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">            [</span><span class="mtk6">&#x27;class&#x27;</span><span class="mtk1"> =&gt; </span><span class="mtk11">AccessListener</span><span class="mtk1">::</span><span class="mtk9">class</span><span class="mtk1">], [</span><span class="mtk6">&#x27;class&#x27;</span><span class="mtk1"> =&gt; </span><span class="mtk6">&#x27;bar&#x27;</span><span class="mtk1">]]</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$throwerChecker</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">ThrowerChecker</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">static</span><span class="mtk1">::</span><span class="mtk3">assertTrue</span><span class="mtk1">(</span><span class="mtk4">$throwerChecker</span><span class="mtk1">-&gt;</span><span class="mtk3">isThrownByFirewall</span><span class="mtk1">(</span><span class="mtk4">$exception</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">/**</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">     * Overrides an exception trace through reflection, since this</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">     * cannot be done through mocking (getTrace is final).</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">     *</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">     * </span><span class="mtk9 mtki">@param</span><span class="mtk5 mtki"> </span><span class="mtk11 mtki">array&lt;int,</span><span class="mtk5 mtki"> array&lt;string, mixed&gt;&gt; $trace</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">     */</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">private</span><span class="mtk1"> </span><span class="mtk9">static</span><span class="mtk1"> </span><span class="mtk9">function</span><span class="mtk1"> </span><span class="mtk3">overrideExceptionTrace</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        \</span><span class="mtk11">Exception</span><span class="mtk1"> </span><span class="mtk4">$exception</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">array</span><span class="mtk1"> </span><span class="mtk4">$trace</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ): </span><span class="mtk11">void</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$exceptionReflection</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">\ReflectionObject</span><span class="mtk1">(</span><span class="mtk4">$exception</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">while</span><span class="mtk1"> (</span><span class="mtk4">$exceptionReflection</span><span class="mtk1">-&gt;</span><span class="mtk3">getParentClass</span><span class="mtk1">() </span><span class="mtk8">!==</span><span class="mtk1"> </span><span class="mtk7">false</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">$exceptionReflection</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">$exceptionReflection</span><span class="mtk1">-&gt;</span><span class="mtk3">getParentClass</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$traceReflection</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">$exceptionReflection</span><span class="mtk1">-&gt;</span><span class="mtk3">getProperty</span><span class="mtk1">(</span><span class="mtk6">&#x27;trace&#x27;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$traceReflection</span><span class="mtk1">-&gt;</span><span class="mtk3">setAccessible</span><span class="mtk1">(</span><span class="mtk7">true</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$traceReflection</span><span class="mtk1">-&gt;</span><span class="mtk3">setValue</span><span class="mtk1">(</span><span class="mtk4">$exception</span><span class="mtk1">, </span><span class="mtk4">$trace</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">$traceReflection</span><span class="mtk1">-&gt;</span><span class="mtk3">setAccessible</span><span class="mtk1">(</span><span class="mtk7">false</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre><p>And that&#x27;s it! We use a loop to find the reflection of the <code>Exception</code> class, then <a href="https://www.php.net/manual/en/reflectionproperty.setaccessible.php">we make the property accessible</a>, we rewrite it, and we make it private again.</p><p>Note that this kind of mock should be an… <em>exception</em> (I&#x27;m funny at parties)! This was done only to fix a bug in vendor code ; with proper software architecture this shouldn&#x27;t happen.</p><style class="grvsc-styles">
  
  .one-dark-pro {
    background-color: #282c34;
    color: #abb2bf;
  }
  .one-dark-pro .mtki { font-style: italic; }
  .one-dark-pro .mtk9 { color: #C678DD; }
  .one-dark-pro .mtk1 { color: #ABB2BF; }
  .one-dark-pro .mtk11 { color: #E5C07B; }
  .one-dark-pro .mtk3 { color: #61AFEF; }
  .one-dark-pro .mtk4 { color: #E06C75; }
  .one-dark-pro .mtk5 { color: #7F848E; }
  .one-dark-pro .mtk8 { color: #56B6C2; }
  .one-dark-pro .mtk6 { color: #98C379; }
  .one-dark-pro .mtk7 { color: #D19A66; }
  .one-dark-pro .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div><div class="content__Content-sc-t48hnk-0 post__Share-sc-l8w1nw-2 bMsSPo kzuCuO"><div><a href="https://twitter.com/intent/tweet?url=undefined&amp;via=johannpardanaud" target="_blank" rel="noopener noreferrer" title="Share on Twitter" aria-label="Share on Twitter" class="button__IconButton-sc-ja09rx-0 post__StyledShareButton-sc-l8w1nw-3 dnHkDR iHUsPX link-no-color-when-inactive"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-fw " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=undefined" target="_blank" rel="noopener noreferrer" title="Share on LinkedIn" aria-label="Share on LinkedIn" class="button__IconButton-sc-ja09rx-0 post__StyledShareButton-sc-l8w1nw-3 dnHkDR iHUsPX link-no-color-when-inactive"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-fw " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></a><a href="https://www.facebook.com/sharer.php?u=undefined" target="_blank" rel="noopener noreferrer" title="Share on Facebook" aria-label="Share on Facebook" class="button__IconButton-sc-ja09rx-0 post__StyledShareButton-sc-l8w1nw-3 dnHkDR iHUsPX link-no-color-when-inactive"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" class="svg-inline--fa fa-facebook-f fa-fw " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg></a></div></div></article></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/mocking-an-exception-in-php/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4a818656962a76617895.js"],"app":["/app-b8f044a4d43bf259ef7a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-3fd80fc84461850e8c30.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-18c38ce676ee07117c4e.js"],"component---src-pages-index-js":["/component---src-pages-index-js-39b2c688497191c226e2.js"],"component---src-templates-post-js":["/component---src-templates-post-js-dcb8e9e5dfbdb1e3ac22.js"]};/*]]>*/</script><script src="/polyfill-4a818656962a76617895.js" nomodule=""></script><script src="/component---src-templates-post-js-dcb8e9e5dfbdb1e3ac22.js" async=""></script><script src="/291a736a4998dc6bb1e7dae6dfd245355445eafd-6ac33ee7d44586680e94.js" async=""></script><script src="/commons-5b2d0278f9ad19a149ab.js" async=""></script><script src="/a9a7754c-af050843e75a27779682.js" async=""></script><script src="/cb1608f2-204ee177e0779f974097.js" async=""></script><script src="/app-b8f044a4d43bf259ef7a.js" async=""></script><script src="/framework-48c52bd1e5a78d41fccc.js" async=""></script><script src="/webpack-runtime-8b19332fe2a1c88eb1a0.js" async=""></script></body></html>