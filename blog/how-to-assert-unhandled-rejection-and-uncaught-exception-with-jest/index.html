<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.dc22e8c7045ddbe5e3b1.css" data-identity="gatsby-global-css">/*!
 * Bootstrap Reboot v4.6.1 (https://getbootstrap.com/)
 * Copyright 2011-2021 The Bootstrap Authors
 * Copyright 2011-2021 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
 * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md)
 */*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:sans-serif;line-height:1.15}article,aside,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}body{background-color:#fff;color:#212529;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1rem;font-weight:400;line-height:1.5;margin:0;text-align:left}[tabindex="-1"]:focus:not(:focus-visible){outline:0!important}hr{box-sizing:content-box;height:0;overflow:visible}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;margin-top:0}p{margin-bottom:1rem;margin-top:0}abbr[data-original-title],abbr[title]{border-bottom:0;cursor:help;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{font-style:normal;line-height:inherit}address,dl,ol,ul{margin-bottom:1rem}dl,ol,ul{margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{background-color:transparent;color:#007bff;text-decoration:none}a:hover{color:#0056b3;text-decoration:underline}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{-ms-overflow-style:scrollbar;margin-bottom:1rem;margin-top:0;overflow:auto}figure{margin:0 0 1rem}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}caption{caption-side:bottom;color:#6c757d;padding-bottom:.75rem;padding-top:.75rem;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}label{display:inline-block;margin-bottom:.5rem}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit;margin:0}button,input{overflow:visible}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}textarea{overflow:auto;resize:vertical}fieldset{border:0;margin:0;min-width:0;padding:0}legend{color:inherit;display:block;font-size:1.5rem;line-height:inherit;margin-bottom:.5rem;max-width:100%;padding:0;white-space:normal;width:100%}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:none;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}output{display:inline-block}summary{cursor:pointer;display:list-item}template{display:none}[hidden]{display:none!important}.grvsc-container{-webkit-overflow-scrolling:touch;-webkit-font-feature-settings:normal;font-feature-settings:normal;border-radius:8px;border-radius:var(--grvsc-border-radius,8px);line-height:1.4;overflow:auto;padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));position:relative}.grvsc-code{display:table}.grvsc-line{box-sizing:border-box;display:table-row;width:100%}.grvsc-line,.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter:before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty:after{content:" ";-webkit-user-select:none;-ms-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem))/2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line:before{content:" ";position:absolute;width:100%}.grvsc-line-diff-add:before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del:before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{opacity:.7;padding:0 2px;text-align:right}:root{--content-spacing:1rem;--shadow:rgba(67,75,81,.25);--grey-100-light:#f1f2f4;--grey-200-light:#e6e8ea;--grey-250-light:#c7cdd1;--grey-300-light:#7e8b95;--grey-400-light:#636f79;--grey-600-light:#49535a;--grey-700-light:#353b41;--grey-800-light:#22272a;--grey-100-dark:#212529;--grey-200-dark:#2d3237;--grey-250-dark:#373e43;--grey-300-dark:#65727b;--grey-400-dark:#86939c;--grey-600-dark:#c7cdd1;--grey-700-dark:#d5d9dd;--grey-800-dark:#e3e6e8;--primary-500-light:#0a71c0;--primary-600-light:#0967ae;--primary-400-dark:#52b4ff;--primary-500-dark:#1f9eff;--note-100-light:#e8ddfd;--note-700-light:#590df2;--note-100-dark:#422e6b;--note-700-dark:#b48fff;--warning-100-light:#fde2e2;--warning-700-light:#d00b0b;--warning-100-dark:#6b2e2e;--warning-700-dark:#ff8f8f;--color-bg-code-light:var(--grey-800-light);--color-bg-code-inline-light:#fff;--color-border-code-inline-light:var(--grey-200-light);--color-bg-code-fold-light:var(--grey-100-light);--color-aside-link-light:var(--primary-600-light);--color-bg-code-dark:var(--grey-200-dark);--color-bg-code-inline-dark:var(--grey-200-dark);--color-border-code-inline-dark:var(--grey-250-dark);--color-bg-code-fold-dark:var(--grey-600-dark);--color-aside-link-dark:var(--primary-400-dark);--grvsc-border-radius:0.32rem;--grvsc-padding-v:1rem;--grvsc-padding-h:1.3rem;--grvsc-line-highlighted-border-width:0.28rem;--grvsc-line-highlighted-border-color:var(--primary-500-dark)}.light-theme:root,:root{--grey-100:var(--grey-100-light);--grey-200:var(--grey-200-light);--grey-250:var(--grey-250-light);--grey-300:var(--grey-300-light);--grey-400:var(--grey-400-light);--grey-600:var(--grey-600-light);--grey-700:var(--grey-700-light);--grey-800:var(--grey-800-light);--primary-500:var(--primary-500-light);--note-100:var(--note-100-light);--note-700:var(--note-700-light);--warning-100:var(--warning-100-light);--warning-700:var(--warning-700-light);--color-bg-code:var(--color-bg-code-light);--color-bg-code-inline:var(--color-bg-code-inline-light);--color-border-code-inline:var(--color-border-code-inline-light);--color-bg-code-fold:var(--color-bg-code-fold-light);--color-aside-link:var(--color-aside-link-light);--grvsc-line-highlighted-background-color:var(--grey-700-light)}@media (prefers-color-scheme:dark){:root{--grey-100:var(--grey-100-dark);--grey-200:var(--grey-200-dark);--grey-250:var(--grey-250-dark);--grey-300:var(--grey-300-dark);--grey-400:var(--grey-400-dark);--grey-600:var(--grey-600-dark);--grey-700:var(--grey-700-dark);--grey-800:var(--grey-800-dark);--primary-500:var(--primary-500-dark);--note-100:var(--note-100-dark);--note-700:var(--note-700-dark);--warning-100:var(--warning-100-dark);--warning-700:var(--warning-700-dark);--color-bg-code:var(--color-bg-code-dark);--color-bg-code-inline:var(--color-bg-code-inline-dark);--color-border-code-inline:var(--color-border-code-inline-dark);--color-bg-code-fold:var(--color-bg-code-fold-dark);--color-aside-link:var(--color-aside-link-dark);--grvsc-line-highlighted-background-color:var(--grey-250-dark)}}.dark-theme:root{--grey-100:var(--grey-100-dark);--grey-200:var(--grey-200-dark);--grey-250:var(--grey-250-dark);--grey-300:var(--grey-300-dark);--grey-400:var(--grey-400-dark);--grey-600:var(--grey-600-dark);--grey-700:var(--grey-700-dark);--grey-800:var(--grey-800-dark);--primary-500:var(--primary-500-dark);--note-100:var(--note-100-dark);--note-700:var(--note-700-dark);--warning-100:var(--warning-100-dark);--warning-700:var(--warning-700-dark);--color-bg-code:var(--color-bg-code-dark);--color-bg-code-inline:var(--color-bg-code-inline-dark);--color-border-code-inline:var(--color-border-code-inline-dark);--color-bg-code-fold:var(--color-bg-code-fold-dark);--color-aside-link:var(--color-aside-link-dark);--grvsc-line-highlighted-background-color:var(--grey-250-dark)}body{background:var(--grey-100);color:var(--grey-600)}p:last-child,ul:last-child{margin-bottom:0}a,a .sublink,a:hover,a:hover .sublink{color:var(--primary-500);text-decoration:underline}.focusable:focus,.focusable:focus-within,a:focus,a:focus .sublink{-moz-outline-radius:3px;outline:2px solid var(--primary-500);outline-offset:.2rem}.link-invisible,.link-invisible:focus,.link-invisible:hover{color:inherit;outline:none;text-decoration:none}.link-no-color-when-inactive:not(:hover):not(:focus):not(:active){color:inherit}code,pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:.9rem}pre,pre.grvsc-container{background:var(--color-bg-code);line-height:1.38rem;margin:0}pre>code{min-width:100%}:not(pre)>code{background:var(--color-bg-code-inline);border:1px solid var(--color-border-code-inline);border-radius:.3em;color:var(--grey-600);overflow-wrap:break-word;padding:.1em .25em;word-break:break-all}a>code{color:var(--primary-500);text-decoration:none}.grvsc-line.grvsc-line-highlighted{background-color:var(--grvsc-line-highlighted-background-color);box-shadow:inset var(--grvsc-line-highlighted-border-width) 0 0 0 var(--grvsc-line-highlighted-border-color)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line:before{content:none}.sr-only{clip:rect(0,0,0,0)!important;border:0!important;height:1px!important;margin:-1px!important;overflow:hidden!important;padding:0!important;position:absolute!important;white-space:nowrap!important;width:1px!important}.svg-inline--fa{display:var(--fa-display,inline-block);height:1em;overflow:visible;vertical-align:-.125em}</style><meta name="generator" content="Gatsby 3.14.6"/><title data-react-helmet="true">How to assert process events with Jest — Blog — Johann Pardanaud</title><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png"/><meta data-react-helmet="true" name="description" content="Developer working @batch — Passionate climber"/><meta data-react-helmet="true" property="og:title" content="How to assert process events with Jest — Blog"/><meta data-react-helmet="true" property="og:description" content="Developer working @batch — Passionate climber"/><meta data-react-helmet="true" property="og:image" content="https://johann.pardanaud.com/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/e82a4/featured.webp"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@undefined"/><meta data-react-helmet="true" name="twitter:title" content="How to assert process events with Jest — Blog"/><meta data-react-helmet="true" name="twitter:description" content="Developer working @batch — Passionate climber"/><script data-react-helmet="true">
                    const darkMode = localStorage.getItem('dark-mode-preference')
                    if (darkMode === 'true' || darkMode === 'false') {
                        document.querySelector('html').classList.add(darkMode === 'true' ? 'dark-theme' : 'light-theme')
                    }
                </script><style data-styled="" data-styled-version="5.3.3">.bMsSPo{margin:0 auto;padding:0 var(--content-spacing);}/*!sc*/
@media (min-width:768px){.bMsSPo{width:42rem;}}/*!sc*/
@media (min-width:992px){.bMsSPo{width:53rem;}}/*!sc*/
data-styled.g1[id="content__Content-sc-t48hnk-0"]{content:"bMsSPo,"}/*!sc*/
.dzdWzc{position:relative;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;padding:0;background:transparent;border:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:1.5625rem;color:inherit;}/*!sc*/
.dzdWzc::after{position:absolute;top:-0.5rem;right:-0.5rem;bottom:-0.5rem;left:-0.5rem;content:"";}/*!sc*/
.dnHkDR{position:relative;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;padding:0;background:transparent;border:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:1.5625rem;}/*!sc*/
.dnHkDR::after{position:absolute;top:-0.5rem;right:-0.5rem;bottom:-0.5rem;left:-0.5rem;content:"";}/*!sc*/
data-styled.g2[id="button__IconButton-sc-ja09rx-0"]{content:"dzdWzc,dnHkDR,"}/*!sc*/
.kzLOCp{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;padding:var(--content-spacing) 0;background:var(--grey-200);font-size:1.125rem;font-weight:500;}/*!sc*/
.kzLOCp .content__Content-sc-t48hnk-0{display:grid;grid-template-rows:auto;grid-template-columns:1fr auto;grid-row-gap:1rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (min-width:768px){.kzLOCp .content__Content-sc-t48hnk-0{grid-template-columns:1fr auto auto;}}/*!sc*/
data-styled.g3[id="header__Container-sc-1fxfhwr-0"]{content:"kzLOCp,"}/*!sc*/
.kftGSv{position:fixed;top:0;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);}/*!sc*/
.kftGSv:not(:focus){opacity:0;pointer-events:none;}/*!sc*/
data-styled.g4[id="header__SkipLink-sc-1fxfhwr-1"]{content:"kftGSv,"}/*!sc*/
.kVWvDI{margin:0;font-size:inherit;font-weight:inherit;text-transform:uppercase;}/*!sc*/
data-styled.g5[id="header__TitleStrong-sc-1fxfhwr-2"]{content:"kVWvDI,"}/*!sc*/
@media (min-width:768px){.dmhOll{display:none;}}/*!sc*/
data-styled.g7[id="header__MenuButton-sc-1fxfhwr-4"]{content:"dmhOll,"}/*!sc*/
.edNlKR{grid-column:span 2;display:none;justify-items:end;grid-row-gap:calc(var(--content-spacing) * 2);grid-column-gap:calc(var(--content-spacing) * 3.5);}/*!sc*/
.edNlKR nav{display:grid;justify-items:end;}/*!sc*/
@media (min-width:768px){.edNlKR{display:grid;grid-auto-flow:column;}.edNlKR nav{grid-auto-flow:column;grid-gap:calc(var(--content-spacing) * 1.5);}}/*!sc*/
data-styled.g8[id="header__Menu-sc-1fxfhwr-5"]{content:"edNlKR,"}/*!sc*/
.eMRrAM:not(:hover):not(:focus):not(:active):not(.active){-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g9[id="header__NavLink-sc-1fxfhwr-6"]{content:"eMRrAM,"}/*!sc*/
.ccpENp{opacity:1;color:inherit;font-size:1.125rem;}/*!sc*/
.cbmlNR{opacity:0.3;color:inherit;font-size:1.125rem;}/*!sc*/
data-styled.g10[id="dark-mode__DarkModeIcon-sc-1kkowl3-0"]{content:"ccpENp,cbmlNR,"}/*!sc*/
.bOEjwE{display:grid;grid-template:"icon";margin:0 calc(var(--content-spacing) / 2);font-size:0.3125rem;}/*!sc*/
.bOEjwE svg{grid-area:icon;}/*!sc*/
.bOEjwE svg:nth-child(1){opacity:0;}/*!sc*/
.bOEjwE svg:nth-child(2){z-index:1;color:var(--primary-500);opacity:1;}/*!sc*/
data-styled.g11[id="dark-mode__DarkModeState-sc-1kkowl3-1"]{content:"bOEjwE,"}/*!sc*/
.cRwCOK{position:absolute;top:calc(100% + calc(var(--content-spacing) / 2));left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);border-radius:3px;padding:0.1em 0.4em;background:var(--grey-400);font-size:0.75rem;color:var(--grey-100);pointer-events:none;opacity:0;}/*!sc*/
data-styled.g12[id="dark-mode__DarkModeTooltip-sc-1kkowl3-2"]{content:"cRwCOK,"}/*!sc*/
.bHoUps{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;cursor:pointer;}/*!sc*/
.bHoUps .dark-mode__DarkModeTooltip-sc-1kkowl3-2,.bHoUps .dark-mode__DarkModeIcon-sc-1kkowl3-0,.bHoUps .dark-mode__DarkModeState-sc-1kkowl3-1 svg{-webkit-transition:all ease 250ms;transition:all ease 250ms;}/*!sc*/
.bHoUps:hover .dark-mode__DarkModeTooltip-sc-1kkowl3-2,.bHoUps:focus .dark-mode__DarkModeTooltip-sc-1kkowl3-2{opacity:1;}/*!sc*/
data-styled.g13[id="dark-mode__DarkModeContainer-sc-1kkowl3-3"]{content:"bHoUps,"}/*!sc*/
.iXgTak{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100vw;min-height:100vh;}/*!sc*/
data-styled.g14[id="layout__Container-sc-z8c7q8-0"]{content:"iXgTak,"}/*!sc*/
.hTFlju{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;padding:calc(var(--content-spacing) * 3) 0;}/*!sc*/
data-styled.g15[id="layout__Body-sc-z8c7q8-1"]{content:"hTFlju,"}/*!sc*/
.zFedH{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:var(--content-spacing);margin-bottom:1.5rem;border-left:4px solid;padding:0.6rem 1rem;line-height:1.6;}/*!sc*/
.zFedH a,.zFedH a:hover{color:var(--color-aside-link);}/*!sc*/
data-styled.g26[id="aside__Aside-sc-21wzby-0"]{content:"zFedH,"}/*!sc*/
.etythn{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:2rem;}/*!sc*/
data-styled.g27[id="aside__AsideIcon-sc-21wzby-1"]{content:"etythn,"}/*!sc*/
.laIcTq{overflow:hidden;}/*!sc*/
data-styled.g28[id="aside__AsideContent-sc-21wzby-2"]{content:"laIcTq,"}/*!sc*/
.kqmYcF{background:var(--note-100);color:var(--note-700);}/*!sc*/
data-styled.g29[id="aside__StyledNote-sc-21wzby-3"]{content:"kqmYcF,"}/*!sc*/
.kAzNIc{background:var(--warning-100);color:var(--warning-700);}/*!sc*/
data-styled.g30[id="aside__StyledWarning-sc-21wzby-4"]{content:"kAzNIc,"}/*!sc*/
.Fophj{margin-left:auto;margin-right:auto;max-width:632px;}/*!sc*/
.FopTW{margin-left:auto;margin-right:auto;max-width:600px;}/*!sc*/
data-styled.g41[id="max-width__MaxWidthStyle-sc-f45ot0-0"]{content:"Fophj,FopTW,"}/*!sc*/
.kVtDtt .content__Content-sc-t48hnk-0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;}/*!sc*/
.kVtDtt h1{font-size:2.5rem;-webkit-letter-spacing:0.015rem;-moz-letter-spacing:0.015rem;-ms-letter-spacing:0.015rem;letter-spacing:0.015rem;line-height:3.5rem;margin:0.5rem 0 2.5rem;}/*!sc*/
data-styled.g42[id="post__Header-sc-l8w1nw-0"]{content:"kVtDtt,"}/*!sc*/
.bRrpOE{font-size:0.8rem;color:var(--grey-400);}/*!sc*/
.bRrpOE address{display:inline;}/*!sc*/
data-styled.g43[id="post__Metadata-sc-l8w1nw-1"]{content:"bRrpOE,"}/*!sc*/
.kzuCuO{position:-webkit-sticky;position:sticky;top:25vh;}/*!sc*/
.kzuCuO >:first-child{position:absolute;left:100%;}/*!sc*/
@media (max-width:767.98px){.kzuCuO{display:none;}}/*!sc*/
@media (min-width:992px){.kzuCuO >:first-child{left:calc(100% + var(--content-spacing) * 1.5);}}/*!sc*/
data-styled.g44[id="post__Share-sc-l8w1nw-2"]{content:"kzuCuO,"}/*!sc*/
.iHUsPX{display:inline-block;margin-bottom:0.5rem;}/*!sc*/
data-styled.g45[id="post__StyledShareButton-sc-l8w1nw-3"]{content:"iHUsPX,"}/*!sc*/
.iwZWCm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-size:1.1rem;}/*!sc*/
.iwZWCm > *{max-width:100%;}/*!sc*/
.iwZWCm .post__Header-sc-l8w1nw-0{-webkit-order:-2;-ms-flex-order:-2;order:-2;}/*!sc*/
.iwZWCm .post__Share-sc-l8w1nw-2{-webkit-order:-1;-ms-flex-order:-1;order:-1;}/*!sc*/
.iwZWCm h2{margin-top:2.1rem;font-size:1.6rem;}/*!sc*/
.iwZWCm h3{margin-top:1.8rem;font-size:1.3rem;}/*!sc*/
.iwZWCm h4{margin-top:1.6rem;font-size:1.1rem;}/*!sc*/
.iwZWCm h5{margin-top:1.4rem;font-size:0.9rem;}/*!sc*/
.iwZWCm h6{margin-top:1.25rem;font-size:0.75rem;}/*!sc*/
.iwZWCm blockquote{border-left:4px solid;padding:0.3rem 1rem;line-height:1.6;font-style:italic;}/*!sc*/
.iwZWCm pre{margin-bottom:1rem;}/*!sc*/
data-styled.g46[id="post__Post-sc-l8w1nw-4"]{content:"iwZWCm,"}/*!sc*/
.fVFuJw{margin-bottom:2.5rem;}/*!sc*/
data-styled.g47[id="post__FeaturedImage-sc-l8w1nw-5"]{content:"fVFuJw,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="alternate" type="application/rss+xml" title="Johann Pardanaud&#x27;s RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-8b19332fe2a1c88eb1a0.js"/><link as="script" rel="preload" href="/framework-48c52bd1e5a78d41fccc.js"/><link as="script" rel="preload" href="/app-b8f044a4d43bf259ef7a.js"/><link as="script" rel="preload" href="/cb1608f2-204ee177e0779f974097.js"/><link as="script" rel="preload" href="/a9a7754c-af050843e75a27779682.js"/><link as="script" rel="preload" href="/commons-5b2d0278f9ad19a149ab.js"/><link as="script" rel="preload" href="/291a736a4998dc6bb1e7dae6dfd245355445eafd-6ac33ee7d44586680e94.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-dcb8e9e5dfbdb1e3ac22.js"/><link as="fetch" rel="preload" href="/page-data/blog/how-to-assert-unhandled-rejection-and-uncaught-exception-with-jest/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1092343521.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Container-sc-z8c7q8-0 iXgTak"><header class="header__Container-sc-1fxfhwr-0 kzLOCp"><a href="#main" class="header__SkipLink-sc-1fxfhwr-1 kftGSv">Skip to content</a><div class="content__Content-sc-t48hnk-0 bMsSPo"><strong class="header__TitleStrong-sc-1fxfhwr-2 kVWvDI">Johann Pardanaud</strong><button aria-label="Open menu" class="button__IconButton-sc-ja09rx-0 header__MenuButton-sc-1fxfhwr-4 dzdWzc dmhOll focusable"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button><div class="header__Menu-sc-1fxfhwr-5 edNlKR"><nav><a class="header__NavLink-sc-1fxfhwr-6 eMRrAM link-no-color-when-inactive" href="/">About</a><a class="header__NavLink-sc-1fxfhwr-6 eMRrAM link-no-color-when-inactive active" href="/blog/">Blog</a></nav><div class="dark-mode__DarkModeContainer-sc-1kkowl3-3 bHoUps focusable" tabindex="0" role="checkbox" aria-checked="mixed" aria-label="Dark mode: auto"><span class="dark-mode__DarkModeTooltip-sc-1kkowl3-2 cRwCOK">Auto</span><span class="dark-mode__DarkModeIcon-sc-1kkowl3-0 ccpENp"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"></path></svg></span><span class="dark-mode__DarkModeState-sc-1kkowl3-1 bOEjwE"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg></span><span class="dark-mode__DarkModeIcon-sc-1kkowl3-0 cbmlNR"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></span></div></div></div></header><main id="main" class="layout__Body-sc-z8c7q8-1 hTFlju"><article class="post__Post-sc-l8w1nw-4 iwZWCm"><header class="post__Header-sc-l8w1nw-0 kVtDtt"><div class="content__Content-sc-t48hnk-0 bMsSPo"><h1>How to assert process events with Jest</h1><p class="post__Metadata-sc-l8w1nw-1 bRrpOE">Published<!-- --> <time dateTime="2021-01-18T00:00:00.000Z">18th January 2021</time>, by Johann Pardanaud</p></div><div class="post__FeaturedImage-sc-l8w1nw-5 fVFuJw gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:37.5%"></div><img aria-hidden="true" src="data:image/webp;base64,UklGRqgAAABXRUJQVlA4IJwAAABwBACdASoUAAgAPm0qkkWkIqGYBABABsSgCdMoRwFfwC14W863HqovMF6w9gD+8LVyH+JVfh9FR2mu2U9qIAtfmUAm9+98qfqOx1fsfm4/ZZ79f4wyTclr5n4deIb1jBZ2MzMD4wJHrW1RlTSSanDLo/nxr3fmvlMYvaUq/SY/WJaBmfhP0QKOCNdbxYhRjcSglkJGrbeWHWjXAAA=" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/2420f/featured.webp 640w,
/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/99b9e/featured.webp 1280w,
/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/cf520/featured.webp 2560w" sizes="(max-width: 2560px) 100vw, 2560px" /><source srcset="/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/2420f/featured.webp 640w,
/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/99b9e/featured.webp 1280w,
/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/cf520/featured.webp 2560w" sizes="(max-width: 2560px) 100vw, 2560px" /><img loading="lazy" sizes="(max-width: 2560px) 100vw, 2560px" srcset="/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/2420f/featured.webp 640w,
/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/99b9e/featured.webp 1280w,
/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/cf520/featured.webp 2560w" src="/static/d87bc6bac9e2a60c5bfdb2bad3d66d64/cf520/featured.webp" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></header><div class="content__Content-sc-t48hnk-0 bMsSPo"><p>I&#x27;m not a long-time user of Jest, I&#x27;ve always used it sporadically. But lately I&#x27;ve being coding more frequently with it and wrote more advanced use cases.</p><p>One of the &quot;advanced&quot; use cases is to assert if an exception is properly thrown inside a <code>setTimeout</code> callback, here&#x27;s a simple example with a function to limit the execution time of our Node process:</p><pre class="grvsc-container one-dark-pro" data-language="js" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">function</span><span class="mtk1"> </span><span class="mtk3">setMaximumExecutionTimeForNode</span><span class="mtk1">(</span><span class="mtk4 mtki">maxTime</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">throw</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">Error</span><span class="mtk1">(</span><span class="mtk6">&quot;Maximum execution time has been reached.&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }, </span><span class="mtk4">maxTime</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre><aside class="aside__Aside-sc-21wzby-0 aside__StyledNote-sc-21wzby-3 zFedH kqmYcF"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="info-circle" class="svg-inline--fa fa-info-circle aside__AsideIcon-sc-21wzby-1 etythn" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></svg><div class="aside__AsideContent-sc-21wzby-2 laIcTq"><span class="sr-only">Note:</span><p>In this blog post, I&#x27;m mainly talking about the <code>uncaughtException</code> event, however everything I explain here can also be applied to the <code>unhandledRejection</code> one. I provide an example at the end.</p></div></aside><p>My first solution was to add a listener on the <code>uncaughtException</code> of the <code>process</code> variable and wait for it to be triggered:</p><pre class="grvsc-container one-dark-pro" data-language="js" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">test</span><span class="mtk1">(</span><span class="mtk6">&quot;exception is thrown when maximum execution time is reached&quot;</span><span class="mtk1">, </span><span class="mtk9">async</span><span class="mtk1"> () </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki">// Resolve the promise once the error as been caught by the listener</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">const</span><span class="mtk1"> </span><span class="mtk11">uncaughtErrorPromise</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">resolve</span><span class="mtk1"> </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">process</span><span class="mtk1">.</span><span class="mtk3">on</span><span class="mtk1">(</span><span class="mtk6">&quot;uncaughtException&quot;</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki">// Set our maximum execution time to 0 to trigger as soon as possible</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">setMaximumExecutionTimeForNode</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki">// Expect our promise to resolve with the error</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">await</span><span class="mtk1"> </span><span class="mtk3">expect</span><span class="mtk1">(</span><span class="mtk4">uncaughtErrorPromise</span><span class="mtk1">).</span><span class="mtk11">resolves</span><span class="mtk1">.</span><span class="mtk3">toBeInstanceOf</span><span class="mtk1">(</span><span class="mtk11">Error</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})</span></span></span></code></pre><p>Unfortunately, this doesn&#x27;t work out of the box, you are told an uncaught exception occured but you are unable to intercept it.</p><p max="632" class="max-width__MaxWidthStyle-sc-f45ot0-0 Fophj"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:850px">
      <a class="gatsby-resp-image-link" href="/static/bd4762ca263cf88abd1d5fb58c6d43c3/e2646/jest-error.webp" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:43.1924882629108%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/webp;base64,UklGRkQAAABXRUJQVlA4IDgAAAAQAwCdASoUAAkAPm0skkWkIqGYBABABsS0gAApUnosbUAA/vRLDEoHQciBqmACPpKKbCfuV8AAAA==&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/bd4762ca263cf88abd1d5fb58c6d43c3/558a3/jest-error.webp 213w,/static/bd4762ca263cf88abd1d5fb58c6d43c3/71a10/jest-error.webp 425w,/static/bd4762ca263cf88abd1d5fb58c6d43c3/4177e/jest-error.webp 850w,/static/bd4762ca263cf88abd1d5fb58c6d43c3/e2646/jest-error.webp 1264w" sizes="(max-width: 850px) 100vw, 850px" type="image/webp"/>
          <source srcSet="/static/bd4762ca263cf88abd1d5fb58c6d43c3/558a3/jest-error.webp 213w,/static/bd4762ca263cf88abd1d5fb58c6d43c3/71a10/jest-error.webp 425w,/static/bd4762ca263cf88abd1d5fb58c6d43c3/4177e/jest-error.webp 850w,/static/bd4762ca263cf88abd1d5fb58c6d43c3/e2646/jest-error.webp 1264w" sizes="(max-width: 850px) 100vw, 850px" type="image/webp"/>
          <img class="gatsby-resp-image-image" src="/static/bd4762ca263cf88abd1d5fb58c6d43c3/4177e/jest-error.webp" alt="Jest output showing our test failed with an uncaught exception" title="Jest output showing our test failed with an uncaught exception" loading="lazy" decoding="async" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
  </a>
    </span></p><p>This happens because <a href="https://github.com/facebook/jest/blob/f0dc9932cba828a1c51ef842c00c1ca51b7f2796/packages/jest-util/src/installCommonGlobals.ts#L19">Jest mocks the <code>process</code> variable</a>! When you call <code>process.on()</code>, you add your listener to an <code>EventEmitter</code> which is not the original one and which will never be called when an uncaught exception occurs.</p><p>This is not something expected by Jest users and <a href="https://github.com/facebook/jest/issues/5620">it brings problems for everyone</a>. To fix this, we need to add our listener on the original process instance. But the real issue here is that <strong>Jest doesn&#x27;t provide any API to retrieve the original global objects it mocks</strong>.</p><p>A solution is to store the original process instance somewhere before Jest starts, we can do this by creating a bootstrap file:</p><pre class="grvsc-container one-dark-pro" data-language="js" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">#!/usr/bin/env node</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// Pass the original process to a closure stored in the `process._original` property.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// Use a closure to ensure the stored value will not change when running tests.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">process</span><span class="mtk1">.</span><span class="mtk4">_original</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> (</span><span class="mtk9">function</span><span class="mtk1"> (</span><span class="mtk4 mtki">_original</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk9">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk4">_original</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})(</span><span class="mtk4">process</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// Run Jest</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">require</span><span class="mtk1">(</span><span class="mtk6">&quot;jest/bin/jest&quot;</span><span class="mtk1">)</span></span></span></code></pre><p>Now, instead of running the <code>jest</code> command, we can make our file executable with <code>chmod +x .bin/jest</code> and run it directly in our terminal by typing <code>.bin/jest</code>. If you use NPM to run your tests, simply replace the jest command with the bootstrap file:</p><pre class="grvsc-container grvsc-has-line-highlighting one-dark-pro" data-language="json" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">&quot;scripts&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">&quot;test&quot;</span><span class="mtk1">: </span><span class="mtk6">&quot;.bin/jest&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre><p>Finally, we can replace our usage of <code>process</code> by <code>process._original()</code>:</p><pre class="grvsc-container grvsc-has-line-highlighting one-dark-pro" data-language="js" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">test</span><span class="mtk1">(</span><span class="mtk6">&quot;exception is thrown when maximum execution time is reached&quot;</span><span class="mtk1">, </span><span class="mtk9">async</span><span class="mtk1"> () </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki">// Resolve the promise once the error as been caught by the listener</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">const</span><span class="mtk1"> </span><span class="mtk11">uncaughtErrorPromise</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">resolve</span><span class="mtk1"> </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line grvsc-line-highlighted"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">process</span><span class="mtk1">.</span><span class="mtk3">_original</span><span class="mtk1">().</span><span class="mtk3">on</span><span class="mtk1">(</span><span class="mtk6">&quot;uncaughtException&quot;</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki">// Set our maximum execution time to 0 to trigger as soon as possible</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">setMaximumExecutionTimeForNode</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5 mtki">// Expect our promise to resolve with the error</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">await</span><span class="mtk1"> </span><span class="mtk3">expect</span><span class="mtk1">(</span><span class="mtk4">uncaughtErrorPromise</span><span class="mtk1">).</span><span class="mtk11">resolves</span><span class="mtk1">.</span><span class="mtk3">toBeInstanceOf</span><span class="mtk1">(</span><span class="mtk11">Error</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})</span></span></span></code></pre><p>However, when you run Jest, you can see the test fails in the same way as on our first try, <a href="https://github.com/facebook/jest/blob/f0dc9932cba828a1c51ef842c00c1ca51b7f2796/packages/jest-circus/src/globalErrorHandlers.ts#L23-L24">because Jest registers its own listeners</a>. To fix that you have to remove the listeners before running your test and restore them right after:</p><pre class="grvsc-container one-dark-pro" data-language="js" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// Store the original listeners in an object containing</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// an array for each event we need to alter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">const</span><span class="mtk1"> </span><span class="mtk11">originalJestListeners</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">uncaughtException</span><span class="mtk1">: [],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">unhandledRejection</span><span class="mtk1">: [],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// For each event, we retrieve the registered listeners, store them</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// in our global object and remove them from the event emitter.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">beforeEach</span><span class="mtk1">(() </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">const</span><span class="mtk1"> </span><span class="mtk11">originalProcess</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">process</span><span class="mtk1">.</span><span class="mtk3">_original</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">Object</span><span class="mtk1">.</span><span class="mtk3">keys</span><span class="mtk1">(</span><span class="mtk4">originalJestListeners</span><span class="mtk1">).</span><span class="mtk3">forEach</span><span class="mtk1">(</span><span class="mtk4 mtki">event</span><span class="mtk1"> </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">originalProcess</span><span class="mtk1">.</span><span class="mtk3">listeners</span><span class="mtk1">(</span><span class="mtk4">event</span><span class="mtk1">).</span><span class="mtk3">forEach</span><span class="mtk1">(</span><span class="mtk4 mtki">listener</span><span class="mtk1"> </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk4">originalJestListeners</span><span class="mtk1">[</span><span class="mtk4">event</span><span class="mtk1">].</span><span class="mtk3">push</span><span class="mtk1">(</span><span class="mtk4">listener</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">originalProcess</span><span class="mtk1">.</span><span class="mtk3">off</span><span class="mtk1">(</span><span class="mtk4">event</span><span class="mtk1">, </span><span class="mtk4">listener</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// For each event, we retrieve the listeners stored in the global object</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">// and we register them on the event emitter.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">afterEach</span><span class="mtk1">(() </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">let</span><span class="mtk1"> </span><span class="mtk4">listener</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">Object</span><span class="mtk1">.</span><span class="mtk3">keys</span><span class="mtk1">(</span><span class="mtk4">originalJestListeners</span><span class="mtk1">).</span><span class="mtk3">forEach</span><span class="mtk1">(</span><span class="mtk4 mtki">event</span><span class="mtk1"> </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">while</span><span class="mtk1"> ((</span><span class="mtk4">listener</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">originalJestListeners</span><span class="mtk1">[</span><span class="mtk4">event</span><span class="mtk1">].</span><span class="mtk3">pop</span><span class="mtk1">()) </span><span class="mtk8">!==</span><span class="mtk1"> </span><span class="mtk7">undefined</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk4">process</span><span class="mtk1">.</span><span class="mtk3">_original</span><span class="mtk1">().</span><span class="mtk3">on</span><span class="mtk1">(</span><span class="mtk4">event</span><span class="mtk1">, </span><span class="mtk4">listener</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})</span></span></span></code></pre><p>Now our test succeeds! 🎉</p><p max="600" class="max-width__MaxWidthStyle-sc-f45ot0-0 FopTW"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:850px">
      <a class="gatsby-resp-image-link" href="/static/5aeb55bf59d61bd0659b4b4826f9ab3e/68fc1/jest-success.webp" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:29.107981220657276%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/webp;base64,UklGRkIAAABXRUJQVlA4IDYAAAAQAwCdASoUAAYAPm0skUWkIqGYBABABsS0gAAt8IBahcAA/vGJbGyc8XvlE62Hf3x/P3/AAAA=&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/5aeb55bf59d61bd0659b4b4826f9ab3e/558a3/jest-success.webp 213w,/static/5aeb55bf59d61bd0659b4b4826f9ab3e/71a10/jest-success.webp 425w,/static/5aeb55bf59d61bd0659b4b4826f9ab3e/4177e/jest-success.webp 850w,/static/5aeb55bf59d61bd0659b4b4826f9ab3e/68fc1/jest-success.webp 1200w" sizes="(max-width: 850px) 100vw, 850px" type="image/webp"/>
          <source srcSet="/static/5aeb55bf59d61bd0659b4b4826f9ab3e/558a3/jest-success.webp 213w,/static/5aeb55bf59d61bd0659b4b4826f9ab3e/71a10/jest-success.webp 425w,/static/5aeb55bf59d61bd0659b4b4826f9ab3e/4177e/jest-success.webp 850w,/static/5aeb55bf59d61bd0659b4b4826f9ab3e/68fc1/jest-success.webp 1200w" sizes="(max-width: 850px) 100vw, 850px" type="image/webp"/>
          <img class="gatsby-resp-image-image" src="/static/5aeb55bf59d61bd0659b4b4826f9ab3e/4177e/jest-success.webp" alt="Jest output showing our test has succeeded" title="Jest output showing our test has succeeded" loading="lazy" decoding="async" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
  </a>
    </span></p><aside class="aside__Aside-sc-21wzby-0 aside__StyledWarning-sc-21wzby-4 zFedH kAzNIc"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="exclamation-triangle" class="svg-inline--fa fa-exclamation-triangle aside__AsideIcon-sc-21wzby-1 etythn" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"></path></svg><div class="aside__AsideContent-sc-21wzby-2 laIcTq"><span class="sr-only">Warning:</span><p>Never remove the default listeners in a <em>classic</em> test, you will break the output in case of an unhandled rejection, and the tests will stop in case of an uncaught exception.</p></div></aside><p>In case you were wandering how to assert if a promise rejection was unhandled, it&#x27;s pretty much the same:</p><pre class="grvsc-container one-dark-pro" data-language="js" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">test</span><span class="mtk1">(</span><span class="mtk6">&quot;promise is rejected&quot;</span><span class="mtk1">, </span><span class="mtk9">async</span><span class="mtk1"> () </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">const</span><span class="mtk1"> </span><span class="mtk11">unhandledRejectionPromise</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">resolve</span><span class="mtk1"> </span><span class="mtk9">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">process</span><span class="mtk1">.</span><span class="mtk3">_original</span><span class="mtk1">().</span><span class="mtk3">on</span><span class="mtk1">(</span><span class="mtk6">&quot;unhandledRejection&quot;</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk6">&quot;test&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">await</span><span class="mtk1"> </span><span class="mtk3">expect</span><span class="mtk1">(</span><span class="mtk4">unhandledRejectionPromise</span><span class="mtk1">).</span><span class="mtk11">resolves</span><span class="mtk1">.</span><span class="mtk3">toBe</span><span class="mtk1">(</span><span class="mtk6">&quot;test&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})</span></span></span></code></pre><p>That&#x27;s it, we&#x27;re now able to assert if an exception was uncaught or if a promise rejection was unhandled. We&#x27;re not using any public API so we must be careful because this is an undocumented area, however I don&#x27;t think this will easily break since we&#x27;re not removing or disabling the mocks.</p><style class="grvsc-styles">
  
  .one-dark-pro {
    background-color: #282c34;
    color: #abb2bf;
  }
  .one-dark-pro .mtki { font-style: italic; }
  .one-dark-pro .mtk9 { color: #C678DD; }
  .one-dark-pro .mtk1 { color: #ABB2BF; }
  .one-dark-pro .mtk3 { color: #61AFEF; }
  .one-dark-pro .mtk4 { color: #E06C75; }
  .one-dark-pro .mtk8 { color: #56B6C2; }
  .one-dark-pro .mtk11 { color: #E5C07B; }
  .one-dark-pro .mtk6 { color: #98C379; }
  .one-dark-pro .mtk5 { color: #7F848E; }
  .one-dark-pro .mtk7 { color: #D19A66; }
  .one-dark-pro .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div><div class="content__Content-sc-t48hnk-0 post__Share-sc-l8w1nw-2 bMsSPo kzuCuO"><div><a href="https://twitter.com/intent/tweet?url=undefined&amp;via=johannpardanaud" target="_blank" rel="noopener noreferrer" title="Share on Twitter" aria-label="Share on Twitter" class="button__IconButton-sc-ja09rx-0 post__StyledShareButton-sc-l8w1nw-3 dnHkDR iHUsPX link-no-color-when-inactive"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-fw " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=undefined" target="_blank" rel="noopener noreferrer" title="Share on LinkedIn" aria-label="Share on LinkedIn" class="button__IconButton-sc-ja09rx-0 post__StyledShareButton-sc-l8w1nw-3 dnHkDR iHUsPX link-no-color-when-inactive"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-fw " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></a><a href="https://www.facebook.com/sharer.php?u=undefined" target="_blank" rel="noopener noreferrer" title="Share on Facebook" aria-label="Share on Facebook" class="button__IconButton-sc-ja09rx-0 post__StyledShareButton-sc-l8w1nw-3 dnHkDR iHUsPX link-no-color-when-inactive"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" class="svg-inline--fa fa-facebook-f fa-fw " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg></a></div></div></article></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/how-to-assert-unhandled-rejection-and-uncaught-exception-with-jest/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4a818656962a76617895.js"],"app":["/app-b8f044a4d43bf259ef7a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-3fd80fc84461850e8c30.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-18c38ce676ee07117c4e.js"],"component---src-pages-index-js":["/component---src-pages-index-js-39b2c688497191c226e2.js"],"component---src-templates-post-js":["/component---src-templates-post-js-dcb8e9e5dfbdb1e3ac22.js"]};/*]]>*/</script><script src="/polyfill-4a818656962a76617895.js" nomodule=""></script><script src="/component---src-templates-post-js-dcb8e9e5dfbdb1e3ac22.js" async=""></script><script src="/291a736a4998dc6bb1e7dae6dfd245355445eafd-6ac33ee7d44586680e94.js" async=""></script><script src="/commons-5b2d0278f9ad19a149ab.js" async=""></script><script src="/a9a7754c-af050843e75a27779682.js" async=""></script><script src="/cb1608f2-204ee177e0779f974097.js" async=""></script><script src="/app-b8f044a4d43bf259ef7a.js" async=""></script><script src="/framework-48c52bd1e5a78d41fccc.js" async=""></script><script src="/webpack-runtime-8b19332fe2a1c88eb1a0.js" async=""></script></body></html>